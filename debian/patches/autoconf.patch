Goal: move changes to autogenerated files into their own patch now that we've
      lost the script that was calling autogen.sh for us; this also helps
      make debian/rules clean just a little bit cleaner.

Fixes: no specific bug

Status wrt upstream: Debian specific

Note: This patch will normally have to be updated by hand after every
      new upstream release and after updates of any other patches that
      touch configure.in -- the first because configure scripts don't
      hold patches well between updates, the second so that our changes
      are recognized in the version of the script actually used in the
      build process.

      The process for refreshing this patch is:

 export QUILT_PATCHES=debian/patches
 quilt push autoconf.patch # to get everything applied up to this point
 quilt push -f autoconf.patch # to override the errors when applying
 (cd source && -Im4 -I../m4 -I../lib/replace -I../source4)
   # the -I lib/replace is needed because upstream seems to have done
   # something screwy with where their m4 include files are distributed in the
   # source tree; so this option may not be necessary in the future
 quilt refresh
 find . -name '*.rej' | xargs rm

Index: samba-3.4.0pre1/source3/configure
===================================================================
--- samba-3.4.0pre1.orig/source3/configure
+++ samba-3.4.0pre1/source3/configure
@@ -14606,6 +14606,27 @@
       fi
     ;;
 
+# Systems with LFS support.
+#
+    gnu* | k*bsd*-gnu)
+	CPPFLAGS="-D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE $CPPFLAGS"
+
+cat >>confdefs.h <<\_ACEOF
+#define _LARGEFILE64_SOURCE 1
+_ACEOF
+
+
+cat >>confdefs.h <<\_ACEOF
+#define _FILE_OFFSET_BITS 64
+_ACEOF
+
+
+cat >>confdefs.h <<\_ACEOF
+#define _GNU_SOURCE 1
+_ACEOF
+
+	;;
+
 # Tests for linux LFS support. Need kernel 2.4 and glibc2.2 or greater support.
 #
     *linux*)
@@ -45605,7 +45626,7 @@
 #
 #
 case "$host_os" in
-    *linux*)
+    linux*-gnu* | gnu* | k*bsd*-gnu)
        # glibc <= 2.3.2 has a broken getgrouplist
        if test "$cross_compiling" = yes; then
   { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
@@ -51598,11 +51619,14 @@
 
   # and these are for particular systems
   case "$host_os" in
-		*linux*)
+		linux*-gnu* | gnu* | k*bsd*-gnu)
+			case "$host_os" in linux*)
+
 cat >>confdefs.h <<\_ACEOF
 #define LINUX 1
 _ACEOF
-
+ ;;
+			esac
 			BLDSHARED="true"
 			if test "${ac_cv_gnu_ld_no_default_allow_shlib_undefined}" = "yes"; then
 				LDSHFLAGS="-shared -Wl,-Bsymbolic -Wl,--allow-shlib-undefined"
@@ -77030,7 +77054,7 @@
 $as_echo "yes" >&6; };
 
 	case "$host_os" in
-	*linux*)
+	linux*-gnu* | gnu* | k*bsd*-gnu)
 		{ $as_echo "$as_me:$LINENO: checking for linux sendfile64 support" >&5
 $as_echo_n "checking for linux sendfile64 support... " >&6; }
 if test "${samba_cv_HAVE_SENDFILE64+set}" = set; then
@@ -78329,11 +78353,11 @@
 WINBIND_NSS_PTHREAD=""
 
 case "$host_os" in
-	*linux*)
+	linux*-gnu* | gnu* | k*bsd*-gnu)
 		NSSSONAMEVERSIONSUFFIX=".2"
 		WINBIND_NSS_EXTRA_OBJS="../nsswitch/winbind_nss_linux.o"
 		;;
-	*freebsd[5-9]*)
+	freebsd5*|*freebsd[6-9]*)
 		# FreeBSD winbind client is implemented as a wrapper around
 		# the Linux version.
 		NSSSONAMEVERSIONSUFFIX=".1"
